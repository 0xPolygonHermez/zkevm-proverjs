# Full tracer comparator
This service compares a full tracer trace generated by proverjs execution with the geth trace generated by a geth node debug call. 
The flow of the script is the following: 
1. Configure the genesis.json file for geth configuration from the genesis of the configured test
2. Start a dockerized geth with the configured genesis
3. Execute test transactions to geth
4. Retrieve the traces of those transactions from geth
5. Execute and retrieve the traces from executing the tests at proverjs
6. Format full tracer trace as geth
7. Compare both traces

### Pre-requisites:

- node
- Docker

To start the script:
```
cd tools/full-tracer-tests
node --max-old-space-size=16000 full-tracer-tests.js
```
To add new tests to the script append the test name to `config.json`: 
```
   {
        "testName":"op-invalid", // name of the test from test-vectors
        "testToDebug": 0, // Test index
        "traceMethod": "defaultTracer",
        "isEthereumTest": false // Set the flag to true in case of ethereum test instead of state transition test
   }
```


It's also posible to add a state transition or ethereum suite test folder. In this case, all the tests in the folder will be run.
```
   {
        "folderName": "calldata", // name of the folder in state transition
        "traceMethod": "defaultTracer",
        "isEthereumTest": false
   }
```
In case is a Ethereum test suite folder
```
   {
        "folderName":"stArgsZeroOneBalance", // name of the folder in ethereum tests
        "traceMethod": "defaultTracer",
        "isEthereumTest": true
   }
```
In case to test callTracer
```
   {
        "folderName":"stArgsZeroOneBalance", // name of the folder in ethereum tests
        "traceMethod": "callTracer", // change emthod to callTracer
        "isEthereumTest": true
   }
```
### Known differences:

In case of a failing opcode runing in a depth > 1, for example out of gas or doing a sstore in a static call the gas cost is computed differently. In geth, the gas cost is shown as the cost of the correct opcode execution. In case of full tracer, the gas cost is shown as the gas cost of the error, the remaining gas of the call.